(function(e){function l(e,t,n,r){var i="";for(var s=0,o=n.length;s<o;s++){i+=r(n[s],t)}return"<tr>"+i+"</tr>"}function c(e,t){var n=e.attributeWriter(t),r="<td";if(e.hidden||e.textAlign){r+=' style="';if(e.hidden){r+="display: none;"}if(e.textAlign){r+="text-align: "+e.textAlign+";"}r+='"'}if(e.cssClass){r+=' class="'+e.cssClass+'"'}return r+">"+n+"</td>"}function h(e){return e[this.id]}function p(t,n){return e(t).html()}function v(t,n){var r=this;this.update=function(){var r="",i=n.table.columns,s=n.writers._rowWriter,u=n.writers._cellWriter;t.$element.trigger("dynatable:beforeUpdate",r);for(var a=0,f=n.dataset.records.length;a<f;a++){var l=n.dataset.records[a],c=s(a,l,i,u);r+=c}if(n.features.recordCount){e("#dynatable-record-count-"+t.element.id).replaceWith(t.recordsCount.create())}if(n.features.paginate){e("#dynatable-pagination-links-"+t.element.id).replaceWith(t.paginationLinks.create());if(n.features.perPageSelect){e("#dynatable-per-page-"+t.element.id).val(parseInt(n.dataset.perPage))}}if(n.features.sort&&i){t.sortsHeaders.removeAllArrows();for(var a=0,f=i.length;a<f;a++){var h=i[a],p=o.allMatch(n.dataset.sorts,h.sorts,function(e,t){return t in e}),d=n.dataset.sorts[h.sorts[0]];if(p){t.$element.find('[data-dynatable-column="'+h.id+'"]').find(".dynatable-sort-header").each(function(){if(d==1){t.sortsHeaders.appendArrowUp(e(this))}else{t.sortsHeaders.appendArrowDown(e(this))}})}}}if(n.inputs.queries||n.features.search){var v=n.inputs.queries||e();if(n.features.search){v=v.add("#dynatable-query-search-"+t.element.id)}v.each(function(){var t=e(this),r=n.dataset.queries[t.data("dynatable-query")];t.val(r||"")})}t.$element.find(n.table.bodyRowSelector).remove();t.$element.append(r);t.$element.trigger("dynatable:afterUpdate",r)}}function m(t,n){var i=this;this.initOnLoad=function(){return t.$element.is("table")};this.init=function(){n.table.columns=[];this.getFromTable()};this.getFromTable=function(){var r=t.$element.find(n.table.headRowSelector).children("th,td");if(r.length){r.each(function(t){i.add(e(this),t,true)})}else{return e.error("Couldn't find any columns headers in '"+n.table.headRowSelector+" th,td'. If your header row is different, specify the selector in the table: headRowSelector option.")}};this.add=function(i,s,u,a){var f=n.table.columns,l=i.text(),c=i.data("dynatable-column")||o.normalizeText(l,n.table.defaultColumnIdStyle),h=i.data("dynatable-sorts"),p=h?e.map(h.split(","),function(t){return e.trim(t)}):[c];if(!c){this.generate(i);c=i.data("dynatable-column")}f.splice(s,0,{index:s,label:l,id:c,attributeWriter:n.writers[c]||n.writers._attributeWriter,attributeReader:n.readers[c]||n.readers._attributeReader,sorts:p,hidden:i.css("display")==="none",textAlign:n.table.copyHeaderAlignment&&i.css("text-align"),cssClass:n.table.copyHeaderClass&&i.attr("class")});i.attr("data-dynatable-column",c).addClass("dynatable-head");if(n.table.headRowClass){i.addClass(n.table.headRowClass)}if(!u){var d=s+1,v=t.$element.find(n.table.headRowSelector).children("th:nth-child("+d+"),td:nth-child("+d+")").first(),m=f.slice(s+1,f.length);if(v.length){v.before(i)}else{t.$element.find(n.table.headRowSelector).append(i)}t.sortsHeaders.attachOne(i.get());if(m.length){for(var g=0,y=m.length;g<y;g++){m[g].index+=1}}if(!a){t.dom.update()}}return r};this.remove=function(e){var r=n.table.columns,i=r.length;if(typeof e==="number"){var s=r[e];this.removeFromTable(s.id);this.removeFromArray(e)}else{for(var o=r.length-1;o>=0;o--){var s=r[o];if(s.id===e){this.removeFromTable(e);this.removeFromArray(o)}}}t.dom.update()};this.removeFromTable=function(e){t.$element.find(n.table.headRowSelector).children('[data-dynatable-column="'+e+'"]').first().remove()};this.removeFromArray=function(e){var t=n.table.columns,r;t.splice(e,1);r=t.slice(e,t.length);for(var i=0,s=r.length;i<s;i++){r[i].index-=1}};this.generate=function(t){var n=t===undefined?e("<th></th>"):t;return this.attachGeneratedAttributes(n)};this.attachGeneratedAttributes=function(e){var r=t.$element.find(n.table.headRowSelector).children("th[data-dynatable-generated]").length;return e.attr("data-dynatable-column","dynatable-generated-"+r).attr("data-dynatable-no-sort","true").attr("data-dynatable-generated",r)}}function g(t,n){var r=this;this.initOnLoad=function(){return!n.dataset.ajax};this.init=function(){if(n.dataset.records===null){n.dataset.records=this.getFromTable();if(!n.dataset.queryRecordCount){n.dataset.queryRecordCount=this.count()}if(!n.dataset.totalRecordCount){n.dataset.totalRecordCount=n.dataset.queryRecordCount}}n.dataset.originalRecords=e.extend(true,[],n.dataset.records)};this.updateFromJson=function(e){var t;if(n.params.records==="_root"){t=e}else if(n.params.records in e){t=e[n.params.records]}if(n.params.record){var r=t.length-1;for(var i=0;i<r;i++){t[i]=t[i][n.params.record]}}if(n.params.queryRecordCount in e){n.dataset.queryRecordCount=e[n.params.queryRecordCount]}if(n.params.totalRecordCount in e){n.dataset.totalRecordCount=e[n.params.totalRecordCount]}n.dataset.records=t};this.sort=function(){var r=[].sort,i=n.dataset.sorts,s=n.dataset.sortsKeys,o=n.dataset.sortTypes;var u=function(n,r){var u;if(e.isEmptyObject(i)){u=t.sorts.functions["originalPlacement"](n,r)}else{for(var a=0,f=s.length;a<f;a++){var l=s[a],c=i[l],h=o[l]||t.sorts.guessType(n,r,l);u=t.sorts.functions[h](n,r,l,c);if(u!==0){break}}}return u};return r.call(n.dataset.records,u)};this.paginate=function(){var e=this.pageBounds(),t=e[0],r=e[1];n.dataset.records=n.dataset.records.slice(t,r)};this.resetOriginal=function(){n.dataset.records=n.dataset.originalRecords||[]};this.pageBounds=function(){var e=n.dataset.page||1,t=(e-1)*n.dataset.perPage,r=Math.min(t+n.dataset.perPage,n.dataset.queryRecordCount);return[t,r]};this.getFromTable=function(){var r=[],i=n.table.columns,s=t.$element.find(n.table.bodyRowSelector);s.each(function(s){var o={};o["dynatable-original-index"]=s;e(this).find("th,td").each(function(n){if(i[n]===undefined){t.domColumns.add(t.domColumns.generate(),i.length,false,true)}var r=i[n].attributeReader(this,o),s=i[n].id;if(typeof r==="string"&&r.match(/\s*\<.+\>/)){if(!o["dynatable-sortable-text"]){o["dynatable-sortable-text"]={}}o["dynatable-sortable-text"][s]=e.trim(e("<div></div>").html(r).text())}o[s]=r});if(typeof n.readers._rowReader==="function"){n.readers._rowReader(s,this,o)}r.push(o)});return r};this.count=function(){return n.dataset.records.length}}function y(t,n){this.initOnLoad=function(){return n.features.recordCount};this.init=function(){this.attach()};this.create=function(){var e="",r="",i={elementId:t.element.id,recordsShown:t.records.count(),recordsQueryCount:n.dataset.queryRecordCount,recordsTotal:n.dataset.totalRecordCount,collectionName:n.params.records==="_root"?"records":n.params.records,text:n.inputs.recordCountText};if(n.features.paginate){if(i.recordsShown<i.recordsQueryCount){var s=t.records.pageBounds();i.pageLowerBound=s[0]+1;i.pageUpperBound=s[1];e=n.inputs.recordCountPageBoundTemplate}else if(i.recordsShown===i.recordsQueryCount){e=n.inputs.recordCountPageUnboundedTemplate}}if(i.recordsQueryCount<i.recordsTotal){r=n.inputs.recordCountFilteredTemplate}i.pageTemplate=o.template(e,i);i.filteredTemplate=o.template(r,i);i.totalTemplate=o.template(n.inputs.recordCountTotalTemplate,i);i.textTemplate=o.template(n.inputs.recordCountTextTemplate,i);return o.template(n.inputs.recordCountTemplate,i)};this.attach=function(){var r=n.inputs.recordCountTarget?e(n.inputs.recordCountTarget):t.$element;r[n.inputs.recordCountPlacement](this.create())}}function b(t,n){this.init=function(){this.attach()};this.create=function(){var r=e("<div></div>",{html:"<span>"+n.inputs.processingText+"</span>",id:"dynatable-processing-"+t.element.id,"class":"dynatable-processing",style:"position: absolute; display: none;"});return r};this.position=function(){var n=e("#dynatable-processing-"+t.element.id),r=n.children("span"),i=r.outerHeight(),s=r.outerWidth(),o=t.$element,u=o.offset(),a=o.outerHeight(),f=o.outerWidth();n.offset({left:u.left,top:u.top}).width(f).height(a);r.offset({left:u.left+(f-s)/2,top:u.top+(a-i)/2});return n};this.attach=function(){t.$element.before(this.create())};this.show=function(){e("#dynatable-processing-"+t.element.id).show();this.position()};this.hide=function(){e("#dynatable-processing-"+t.element.id).hide()}}function w(t,n){this.initOnLoad=function(){return n.features.pushState&&history.pushState};this.init=function(){window.onpopstate=function(e){if(e.state&&e.state.dynatable){t.state.pop(e)}}};this.push=function(r){var i=window.location.search,s,u,a,f,l,c,h,p=!(window.history.state&&window.history.state.dynatable),d=p?"replaceState":"pushState";if(i&&/^\?/.test(i)){i=i.substring(1)}e.extend(s,r);a=o.refreshQueryString(i,r,n);if(a){a="?"+a}f=window.location.hash;u=window.location.pathname;t.$element.trigger("dynatable:push",r);h={dynatable:{dataset:n.dataset}};if(!p){h.dynatable.scrollTop=e(window).scrollTop()}c=JSON.stringify(h);h.dynatable.dataset.perPageOptions=e.makeArray(h.dynatable.dataset.perPageOptions);try{window.history[d](h,"Dynatable state",u+a+f)}catch(v){h.dynatable.dataset.records=null;window.history[d](h,"Dynatable state",u+a+f)}};this.pop=function(r){var i=r.state.dynatable;n.dataset=i.dataset;if(i.scrollTop){e(window).scrollTop(i.scrollTop)}if(i.dataset.records){t.dom.update()}else{t.process(true)}}}function E(t,n){this.initOnLoad=function(){return n.features.sort};this.init=function(){var e=window.location.search.match(new RegExp(n.params.sorts+"[^&=]*=[^&]*","g"));if(e){n.dataset.sorts=o.deserialize(e)[n.params.sorts]}if(!n.dataset.sortsKeys.length){n.dataset.sortsKeys=o.keysFromObject(n.dataset.sorts)}};this.add=function(i,s){var o=n.dataset.sortsKeys,u=e.inArray(i,o);n.dataset.sorts[i]=s;t.$element.trigger("dynatable:sorts:added",[i,s]);if(u===-1){o.push(i)}return r};this.remove=function(i){var s=n.dataset.sortsKeys,o=e.inArray(i,s);delete n.dataset.sorts[i];t.$element.trigger("dynatable:sorts:removed",i);if(o!==-1){s.splice(o,1)}return r};this.clear=function(){n.dataset.sorts={};n.dataset.sortsKeys.length=0;t.$element.trigger("dynatable:sorts:cleared")};this.guessType=function(e,t,n){var r={string:"string",number:"number","boolean":"number",object:"number"},i=e[n]?typeof e[n]:typeof t[n],s=r[i]||"number";return s};this.functions={number:function(e,t,n,r){return e[n]===t[n]?0:r>0?e[n]-t[n]:t[n]-e[n]},string:function(e,t,n,r){var i=e["dynatable-sortable-text"]&&e["dynatable-sortable-text"][n]?e["dynatable-sortable-text"][n]:e[n],s=t["dynatable-sortable-text"]&&t["dynatable-sortable-text"][n]?t["dynatable-sortable-text"][n]:t[n],o;i=i.toLowerCase();s=s.toLowerCase();o=i===s?0:r>0?i>s:s>i;return o===false?-1:o-0},originalPlacement:function(e,t){return e["dynatable-original-index"]-t["dynatable-original-index"]}}}function S(t,n){var r=this;this.initOnLoad=function(){return n.features.sort};this.init=function(){this.attach()};this.create=function(i){var s=e(i),u=e("<a></a>",{"class":"dynatable-sort-header",href:"#",html:s.html()}),a=s.data("dynatable-column"),f=o.findObjectInArray(n.table.columns,{id:a});u.bind("click",function(e){r.toggleSort(e,u,f);t.process();e.preventDefault()});if(this.sortedByColumn(u,f)){if(this.sortedByColumnValue(f)==1){this.appendArrowUp(u)}else{this.appendArrowDown(u)}}return u};this.removeAll=function(){t.$element.find(n.table.headRowSelector).children("th,td").each(function(){r.removeAllArrows();r.removeOne(this)})};this.removeOne=function(t){var n=e(t),r=n.find(".dynatable-sort-header");if(r.length){var i=r.html();r.remove();n.html(n.html()+i)}};this.attach=function(){t.$element.find(n.table.headRowSelector).children("th,td").each(function(){r.attachOne(this)})};this.attachOne=function(t){var n=e(t);if(!n.data("dynatable-no-sort")){n.html(this.create(t))}};this.appendArrowUp=function(e){this.removeArrow(e);e.append("<span class='dynatable-arrow'> &#9650;</span>")};this.appendArrowDown=function(e){this.removeArrow(e);e.append("<span class='dynatable-arrow'> &#9660;</span>")};this.removeArrow=function(e){e.find(".dynatable-arrow").remove()};this.removeAllArrows=function(){t.$element.find(".dynatable-arrow").remove()};this.toggleSort=function(e,r,i){var s=this.sortedByColumn(r,i),u=this.sortedByColumnValue(i);if(!n.inputs.multisort||!o.anyMatch(e,n.inputs.multisort,function(t,n){return e[n]})){this.removeAllArrows();t.sorts.clear()}if(s){if(u==1){for(var a=0,f=i.sorts.length;a<f;a++){t.sorts.add(i.sorts[a],-1)}this.appendArrowDown(r)}else{for(var a=0,f=i.sorts.length;a<f;a++){t.sorts.remove(i.sorts[a])}this.removeArrow(r)}}else{for(var a=0,f=i.sorts.length;a<f;a++){t.sorts.add(i.sorts[a],1)}this.appendArrowUp(r)}};this.sortedByColumn=function(e,t){return o.allMatch(n.dataset.sorts,t.sorts,function(e,t){return t in e})};this.sortedByColumnValue=function(e){return n.dataset.sorts[e.sorts[0]]}}function x(t,n){var i=this;this.initOnLoad=function(){return n.inputs.queries||n.features.search};this.init=function(){var e=window.location.search.match(new RegExp(n.params.queries+"[^&=]*=[^&]*","g"));n.dataset.queries=e?o.deserialize(e)[n.params.queries]:{};if(n.dataset.queries===""){n.dataset.queries={}}if(n.inputs.queries){this.setupInputs()}};this.add=function(e,i){if(n.features.paginate){n.dataset.page=1}n.dataset.queries[e]=i;t.$element.trigger("dynatable:queries:added",[e,i]);return r};this.remove=function(e){delete n.dataset.queries[e];t.$element.trigger("dynatable:queries:removed",e);return r};this.run=function(){for(query in n.dataset.queries){if(n.dataset.queries.hasOwnProperty(query)){var r=n.dataset.queries[query];if(i.functions[query]===undefined){var s=o.findObjectInArray(n.table.columns,{id:query});if(s){i.functions[query]=function(e,t){return e[query]==t}}else{e.error("Query named '"+query+"' called, but not defined in queries.functions");continue}}n.dataset.records=e.map(n.dataset.records,function(e){return i.functions[query](e,r)?e:null})}}n.dataset.queryRecordCount=t.records.count()};this.runSearch=function(r){var i=e.extend({},n.dataset.queries);if(r){this.add("search",r)}else{this.remove("search")}if(!o.objectsEqual(n.dataset.queries,i)){t.process()}};this.setupInputs=function(){n.inputs.queries.each(function(){var r=e(this),s=r.data("dynatable-query-event")||n.inputs.queryEvent,o=r.data("dynatable-query")||r.attr("name")||this.id,u=function(r){var s=e(this).val();if(s===""){s=undefined}if(s===n.dataset.queries[o]){return false}if(s){i.add(o,s)}else{i.remove(o)}t.process();r.preventDefault()};r.attr("data-dynatable-query",o).bind(s,u).bind("keypress",function(e){if(e.which==13){u.call(this,e)}});if(n.dataset.queries[o]){r.val(decodeURIComponent(n.dataset.queries[o]))}})};this.functions={search:function(e,t){var n=false;for(attr in e){if(e.hasOwnProperty(attr)){var r=e[attr];if(typeof r==="string"&&r.toLowerCase().indexOf(t.toLowerCase())!==-1){n=true;break}else{continue}}}return n}}}function T(t,n){var r=this;this.initOnLoad=function(){return n.features.search};this.init=function(){this.attach()};this.create=function(){var r=e("<input />",{type:"search",id:"dynatable-query-search-"+t.element.id,"data-dynatable-query":"search",value:n.dataset.queries.search}),i=e("<span></span>",{id:"dynatable-search-"+t.element.id,"class":"dynatable-search",text:n.inputs.searchText}).append(r);r.bind(n.inputs.queryEvent,function(){t.queries.runSearch(e(this).val())}).bind("keypress",function(n){if(n.which==13){t.queries.runSearch(e(this).val());n.preventDefault()}});return i};this.attach=function(){var r=n.inputs.searchTarget?e(n.inputs.searchTarget):t.$element;r[n.inputs.searchPlacement](this.create())}}function N(e,t){this.initOnLoad=function(){return t.features.paginate};this.init=function(){var e=window.location.search.match(new RegExp(t.params.page+"=([^&]*)"));if(e&&t.features.pushState){this.set(e[1])}else{this.set(1)}};this.set=function(n){var r=parseInt(n,10);t.dataset.page=r;e.$element.trigger("dynatable:page:set",r)}}function C(t,n){var r=this;this.initOnLoad=function(){return n.features.paginate};this.init=function(){var e=window.location.search.match(new RegExp(n.params.perPage+"=([^&]*)"));if(e&&n.features.pushState){this.set(e[1],true)}else{this.set(n.dataset.perPageDefault,true)}if(n.features.perPageSelect){this.attach()}};this.create=function(){var i=e("<select>",{id:"dynatable-per-page-"+t.element.id,"class":"dynatable-per-page-select"});for(var s=0,o=n.dataset.perPageOptions.length;s<o;s++){var u=n.dataset.perPageOptions[s],a=n.dataset.perPage==u?'selected="selected"':"";i.append('<option value="'+u+'" '+a+">"+u+"</option>")}i.bind("change",function(n){r.set(e(this).val());t.process()});return e("<span />",{"class":"dynatable-per-page"}).append("<span class='dynatable-per-page-label'>"+n.inputs.perPageText+"</span>").append(i)};this.attach=function(){var r=n.inputs.perPageTarget?e(n.inputs.perPageTarget):t.$element;r[n.inputs.perPagePlacement](this.create())};this.set=function(e,r){var i=parseInt(e);if(!r){t.paginationPage.set(1)}n.dataset.perPage=i;t.$element.trigger("dynatable:perPage:set",i)}}function k(t,n){var r=this;this.initOnLoad=function(){return n.features.paginate};this.init=function(){this.attach()};this.create=function(){var r='<ul id="'+"dynatable-pagination-links-"+t.element.id+'" class="'+n.inputs.paginationClass+'">',i=n.inputs.paginationLinkClass,s=n.inputs.paginationActiveClass,o=n.inputs.paginationDisabledClass,u=Math.ceil(n.dataset.queryRecordCount/n.dataset.perPage),a=n.dataset.page,f=[n.inputs.paginationGap[0],n.dataset.page-n.inputs.paginationGap[1],n.dataset.page+n.inputs.paginationGap[2],u+1-n.inputs.paginationGap[3]];r+="<li><span>"+n.inputs.pageText+"</span></li>";for(var l=1;l<=u;l++){if(l>f[0]&&l<f[1]||l>f[2]&&l<f[3]){continue}else{var c=t.paginationLinks.buildLink(l,l,i,a==l,s),h,p;h=e.inArray(l,f);p=f[h+1];if(h>0&&l!==1&&p&&p>l+1){var d='<li><span class="dynatable-page-break">&hellip;</span></li>';c=h<2?d+c:c+d}if(n.inputs.paginationPrev&&l===1){var v=t.paginationLinks.buildLink(a-1,n.inputs.paginationPrev,i+" "+n.inputs.paginationPrevClass,a===1,o);c=v+c}if(n.inputs.paginationNext&&l===u){var m=t.paginationLinks.buildLink(a+1,n.inputs.paginationNext,i+" "+n.inputs.paginationNextClass,a===u,o);c+=m}r+=c}}r+="</ul>";var g="#dynatable-pagination-links-"+t.element.id+" a."+i+":not(."+s+",."+o+")";e(document).undelegate(g,"click.dynatable");e(document).delegate(g,"click.dynatable",function(r){$this=e(this);$this.closest(n.inputs.paginationClass).find("."+s).removeClass(s);$this.addClass(s);t.paginationPage.set($this.data("dynatable-page"));t.process();r.preventDefault()});return r};this.buildLink=function(e,t,n,r,i){var s="<a data-dynatable-page="+e+' class="'+n,o="<li";if(r){s+=" "+i;o+=' class="'+i+'"'}s+='">'+t+"</a>";o+=">"+s+"</li>";return o};this.attach=function(){var r=n.inputs.paginationLinkTarget?e(n.inputs.paginationLinkTarget):t.$element;r[n.inputs.paginationLinkPlacement](t.paginationLinks.create())}}var t,n,r,i,s={dom:v,domColumns:m,records:g,recordsCount:y,processingIndicator:b,state:w,sorts:E,sortsHeaders:S,queries:x,inputsSearch:T,paginationPage:N,paginationPerPage:C,paginationLinks:k},o,u,a,f,l,c,h,p;t={features:{paginate:true,sort:true,pushState:true,search:true,recordCount:true,perPageSelect:true},table:{defaultColumnIdStyle:"camelCase",columns:null,headRowSelector:"thead tr",bodyRowSelector:"tbody tr",headRowClass:null,copyHeaderAlignment:true,copyHeaderClass:false},inputs:{queries:null,sorts:null,multisort:["ctrlKey","shiftKey","metaKey"],page:null,queryEvent:"blur change",recordCountTarget:null,recordCountPlacement:"after",paginationLinkTarget:null,paginationLinkPlacement:"after",paginationClass:"dynatable-pagination-links",paginationLinkClass:"dynatable-page-link",paginationPrevClass:"dynatable-page-prev",paginationNextClass:"dynatable-page-next",paginationActiveClass:"dynatable-active-page",paginationDisabledClass:"dynatable-disabled-page",paginationPrev:dynatable_txt.prev,paginationNext:dynatable_txt.next,paginationGap:[1,2,2,1],searchTarget:null,searchPlacement:"before",searchText:dynatable_txt.search,perPageTarget:null,perPagePlacement:"before",perPageText:dynatable_txt.show,pageText:dynatable_txt.pages,recordCountPageBoundTemplate:dynatable_txt.pagebounds,recordCountPageUnboundedTemplate:dynatable_txt.recordsshown,recordCountTotalTemplate:"{recordsQueryCount} {collectionName}",recordCountFilteredTemplate:dynatable_txt.filtered,recordCountText:dynatable_txt.showing,recordCountTextTemplate:"{text} {pageTemplate} {totalTemplate} {filteredTemplate}",recordCountTemplate:'<span id="dynatable-record-count-{elementId}" class="dynatable-record-count">{textTemplate}</span>',processingText:dynatable_txt.process},dataset:{ajax:false,ajaxUrl:null,ajaxCache:null,ajaxOnLoad:false,ajaxMethod:"GET",ajaxDataType:"json",totalRecordCount:null,queries:{},queryRecordCount:null,page:null,perPageDefault:10,perPageOptions:[10,20,50,100],sorts:{},sortsKeys:[],sortTypes:{},records:null},writers:{_rowWriter:l,_cellWriter:c,_attributeWriter:h},readers:{_rowReader:null,_attributeReader:p},params:{dynatable:"dynatable",queries:"queries",sorts:"sorts",page:"page",perPage:"perPage",offset:"offset",records:dynatable_txt.records,record:null,queryRecordCount:"queryRecordCount",totalRecordCount:"totalRecordCount"}};r={init:function(t,r){this.settings=n(r);this.element=t;this.$element=e(t);u.call(this);return this},process:function(e){a.call(this,e)}};n=function(n){var r=e.extend(true,{},t,n);if(n){if(n.inputs){if(n.inputs.multisort){r.inputs.multisort=n.inputs.multisort}if(n.inputs.paginationGap){r.inputs.paginationGap=n.inputs.paginationGap}}if(n.dataset&&n.dataset.perPageOptions){r.dataset.perPageOptions=n.dataset.perPageOptions}}return r};u=function(){this.$element.trigger("dynatable:preinit",this);for(model in s){if(s.hasOwnProperty(model)){var t=this[model]=new s[model](this,this.settings);if(t.initOnLoad()){t.init()}}}this.$element.trigger("dynatable:init",this);if(!this.settings.dataset.ajax||this.settings.dataset.ajax&&this.settings.dataset.ajaxOnLoad||this.settings.features.paginate||this.settings.features.sort&&!e.isEmptyObject(this.settings.dataset.sorts)){this.process()}};a=function(t){var n={};this.$element.trigger("dynatable:beforeProcess",n);if(!e.isEmptyObject(this.settings.dataset.queries)){n[this.settings.params.queries]=this.settings.dataset.queries}this.processingIndicator.show();if(this.settings.features.sort&&!e.isEmptyObject(this.settings.dataset.sorts)){n[this.settings.params.sorts]=this.settings.dataset.sorts}if(this.settings.features.paginate&&this.settings.dataset.page){var r=this.settings.dataset.page,i=this.settings.dataset.perPage;n[this.settings.params.page]=r;n[this.settings.params.perPage]=i;n[this.settings.params.offset]=(r-1)*i}if(this.settings.dataset.ajaxData){e.extend(n,this.settings.dataset.ajaxData)}if(this.settings.dataset.ajax){var s=this;var u={type:s.settings.dataset.ajaxMethod,dataType:s.settings.dataset.ajaxDataType,data:n,error:function(e,t){},success:function(e){s.$element.trigger("dynatable:ajax:success",e);s.records.updateFromJson(e);s.dom.update();if(!t&&s.state.initOnLoad()){s.state.push(n)}},complete:function(){s.processingIndicator.hide()}};if(this.settings.dataset.ajaxUrl){u.url=this.settings.dataset.ajaxUrl}else{u.url=o.refreshQueryString(window.location.href,{},this.settings)}if(this.settings.dataset.ajaxCache!==null){u.cache=this.settings.dataset.ajaxCache}e.ajax(u)}else{this.records.resetOriginal();this.queries.run();if(this.settings.features.sort){this.records.sort()}if(this.settings.features.paginate){this.records.paginate()}this.dom.update();this.processingIndicator.hide();if(!t&&this.state.initOnLoad()){this.state.push(n)}}this.$element.addClass("dynatable-loaded");this.$element.trigger("dynatable:afterProcess",n)};i={initOnLoad:function(){return true},init:function(){}};for(model in s){if(s.hasOwnProperty(model)){var d=s[model];d.prototype=i}}o=r.utility={normalizeText:function(e,t){e=this.textTransform[t](e);return e},textTransform:{trimDash:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-")},camelCase:function(e){e=this.trimDash(e);return e.replace(/(\-[a-zA-Z])/g,function(e){return e.toUpperCase().replace("-","")}).replace(/([A-Z])([A-Z]+)/g,function(e,t,n){return t+n.toLowerCase()}).replace(/^[A-Z]/,function(e){return e.toLowerCase()})},dashed:function(e){e=this.trimDash(e);return this.lowercase(e)},underscore:function(e){e=this.trimDash(e);return this.lowercase(e.replace(/(-)/g,"_"))},lowercase:function(e){return e.replace(/([A-Z])/g,function(e){return e.toLowerCase()})}},deserialize:function(t){if(!t)return{};if(typeof t==="object"){t=t.join("&")}var n={},r=t.split("&");for(var i=0;i<r.length;i++){var s=r[i].split("="),o=decodeURIComponent(s[0]),u,a;if(!s[1]){continue}u=decodeURIComponent(s[1].replace(/\+/g," "));while(a=o.match(/([^&=]+)\[([^&=]+)\]$/)){var f=u;o=a[1];u={};if(a[2].substr(a[2].length-2)=="]["){u[a[2].substr(0,a[2].length-2)]=[f]}else{u[a[2]]=f}}if(typeof n[o]==="undefined"){if(o.substr(o.length-2)!="[]"){n[o]=u}else{n[o]=[u]}}else if(typeof n[o]==="string"){n[o]=u}else if(typeof n[o]==="object"){n[o]=e.extend({},n[o],u)}else{n[o].push(u)}}return n},refreshQueryString:function(t,n,r){var i=this,s=t.split("?"),o=s.shift(),u;u=this.deserialize(t);for(p in r.params){if(r.params.hasOwnProperty(p)){var a=r.params[p];if(!r.features.sort&&p=="sorts"||!r.features.paginate&&i.anyMatch(p,["page","perPage","offset"],function(e,t){return e==t})){continue}if((p==="page"||p==="offset")&&n["page"]===1){if(u[a]){delete u[a]}continue}if(p==="perPage"&&n[a]==r.dataset.perPageDefault){if(u[a]){delete u[a]}continue}if(p=="queries"&&n[a]){var f=r.inputs.queries||[],l=e.makeArray(f.map(function(){return e(this).attr("name")}));if(r.features.search){l.push("search")}for(var c=0,h=l.length;c<h;c++){var p=l[c];if(n[a][p]){if(typeof u[a]==="undefined"){u[a]={}}u[a][p]=n[a][p]}else{delete u[a][p]}}continue}if(n[a]){u[a]=n[a]}else{delete u[a]}}}return e.param(u)},keysFromObject:function(e){var t=[];for(var n in e){t.push(n)}return t},findObjectInArray:function(e,t){var n=this,r;for(var i=0,s=e.length;i<s;i++){var o=e[i];if(n.allMatch(o,t,function(e,t,n){return e[t]==n})){r=o;break}}return r},allMatch:function(t,n,r){var i=true,s=e.isArray(n);e.each(n,function(e,n){var o=s?r(t,n):r(t,e,n);if(!o){return i=false}});return i},anyMatch:function(t,n,r){var i=false,s=e.isArray(n);e.each(n,function(e,n){var o=s?r(t,n):r(t,e,n);if(o){i=true;return false}});return i},objectsEqual:function(e,t){for(attr in e){if(e.hasOwnProperty(attr)){if(!t.hasOwnProperty(attr)||e[attr]!==t[attr]){return false}}}for(attr in t){if(t.hasOwnProperty(attr)&&!e.hasOwnProperty(attr)){return false}}return true},randomHash:function(){return((1+Math.random())*65536|0).toString(16).substring(1)},template:function(e,t){return e.replace(/{(\w*)}/g,function(e,n){return t.hasOwnProperty(n)?t[n]:""})}};if(typeof Object.create!=="function"){Object.create=function(e){function t(){}t.prototype=e;return new t}}e.dynatableSetup=function(e){t=n(e)};e.dynatable=function(t){e.fn["dynatable"]=function(n){return this.each(function(){if(!e.data(this,"dynatable")){e.data(this,"dynatable",Object.create(t).init(this,n))}})}};e.dynatable(r)})(jQuery)
